<div class="language-switcher">
  <button class="language-button" type="button" aria-haspopup="menu" aria-expanded="false">
    {% assign current_lang_data = site.data.i18n[current_lang] %}
    <span class="flag">{% if current_lang == 'en' %}ğŸ‡ºğŸ‡¸{% elsif current_lang == 'zh' %}ğŸ‡¨ğŸ‡³{% endif %}</span>
    <span class="language-name">{{ current_lang_data.site.language }}</span>
    <span class="chevron"></span>
  </button>
  <div class="language-dropdown" role="menu">
    {% for lang_code in site.languages %}
      {% if lang_code != current_lang %}
        {% assign target_lang_data = site.data.i18n[lang_code] %}
        {% if lang_code == site.default_lang %}
          {% assign target_url = page.url | remove_first: page.lang | remove_first: '/' %}
        {% else %}
          {% assign target_url = page.url | remove_first: page.lang | prepend: lang_code | prepend: '/' %}
        {% endif %}
        <a href="{{ target_url | relative_url }}" class="language-option" role="menuitem" data-lang="{{ lang_code }}">
          <span class="flag">{% if lang_code == 'en' %}ğŸ‡ºğŸ‡¸{% elsif lang_code == 'zh' %}ğŸ‡¨ğŸ‡³{% endif %}</span>
          <span class="language-name">{{ target_lang_data.site.language }}</span>
        </a>
      {% endif %}
    {% endfor %}
  </div>
</div>