<div class="language-switcher">
  <div class="dropdown">
    <button class="dropdown-toggle" type="button" id="languageDropdown" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
      {% assign current_lang = page.lang | default: site.default_lang | default: 'en' %}
      {% if current_lang == 'en' %}
        ðŸ‡ºðŸ‡¸ English
      {% elsif current_lang == 'zh' %}
        ðŸ‡¨ðŸ‡³ ä¸­æ–‡
      {% endif %}
      <span class="caret"></span>
    </button>
    <ul class="dropdown-menu" aria-labelledby="languageDropdown">
      {% assign languages = site.languages | default: site.data.languages %}
      {% for lang in languages %}
        {% assign lang_code = lang[0] | default: lang %}
        {% assign lang_name = lang[1].name | default: lang %}
        
        {% if lang_code == 'en' %}
          {% assign flag = 'ðŸ‡ºðŸ‡¸' %}
          {% assign display_name = 'English' %}
        {% elsif lang_code == 'zh' %}
          {% assign flag = 'ðŸ‡¨ðŸ‡³' %}
          {% assign display_name = 'ä¸­æ–‡' %}
        {% endif %}
        
        {% if lang_code != current_lang %}
          <li>
            {% if lang_code == site.default_lang %}
              {% assign target_url = page.url | remove_first: '/' | split: '/' | shift | join: '/' | prepend: '/' %}
              {% if target_url == '/' %}{% assign target_url = '/' %}{% endif %}
            {% else %}
              {% assign target_url = page.url | remove_first: '/' | split: '/' | shift | join: '/' | prepend: '/' | prepend: lang_code | prepend: '/' %}
            {% endif %}
            <a href="{{ target_url | relative_url }}" class="language-link" data-lang="{{ lang_code }}">
              {{ flag }} {{ display_name }}
            </a>
          </li>
        {% endif %}
      {% endfor %}
    </ul>
  </div>
</div>

<style>
.language-switcher {
  position: relative;
  display: inline-block;
  margin-left: auto;
}

.dropdown-toggle {
  background: none;
  border: 1px solid #ddd;
  padding: 8px 12px;
  border-radius: 4px;
  cursor: pointer;
  font-size: 14px;
  color: #333;
  display: flex;
  align-items: center;
  gap: 5px;
}

.dropdown-toggle:hover {
  background-color: #f5f5f5;
}

.dropdown-menu {
  position: absolute;
  top: 100%;
  right: 0;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
  box-shadow: 0 2px 10px rgba(0,0,0,0.1);
  list-style: none;
  padding: 0;
  margin: 0;
  min-width: 120px;
  display: none;
  z-index: 1000;
}

.dropdown:hover .dropdown-menu {
  display: block;
}

.dropdown-menu li {
  margin: 0;
}

.language-link {
  display: block;
  padding: 8px 12px;
  text-decoration: none;
  color: #333;
  font-size: 14px;
}

.language-link:hover {
  background-color: #f5f5f5;
  text-decoration: none;
}

.caret {
  border-left: 4px solid transparent;
  border-right: 4px solid transparent;
  border-top: 4px solid #333;
  display: inline-block;
  margin-left: 5px;
}
</style>